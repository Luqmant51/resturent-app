<%- include('../partials/headersubpage') %>

  <section class="food_section layout_padding">
    <div class="container">
      <div class="heading_container heading_center">
        <h2>Our Menu</h2>
      </div>

      <div class="filters-content">
        <div class="row grid">
          <% menus.forEach(item=> { %>
            <div class="col-sm-6 col-lg-4 all">
              <div class="box">
                <div class="img-box">
                  <img src="<%= item.image %>" alt="Menu Image"
                    style="max-width: 200px; border: 1px solid #ccc; padding: 5px;">
                </div>
                <div class="detail-box">
                  <h5>
                    <%= item.food_name %>
                  </h5>
                  <p>
                    <%= item.description || '' %>
                  </p>
                  <div class="options">
                    <h6>$<%= item.price %>
                    </h6>
                    <a href="javascript:void(0);" class="add-to-cart" data-id="<%= item.id %>"
                      data-name="<%= item.name %>" data-price="<%= item.price %>">
                      ðŸ›’
                    </a>

                  </div>
                </div>
              </div>
            </div>
            <% }) %>
        </div>
      </div>
    </div>
  </section>

  <!-- Order Confirm Modal -->
  <div id="orderModal"
    style="display:none; position:fixed; top:30%; left:35%; background:white; padding:20px; border:1px solid #ccc; z-index:1000;">
    <h3 id="modalFoodName"></h3>
    <p>Price: $<span id="modalPrice"></span></p>
    <label>Quantity:
      <input type="number" id="modalQty" value="1" min="1">
    </label>
    <p>Total: $<span id="modalTotal"></span></p>
    <button id="confirmOrderBtn">Confirm Order</button>
    <button id="cancelOrderBtn">Cancel</button>
  </div>

  <script>
    let selectedItem = {};

    // Open modal when Add-to-Cart is clicked
    document.querySelectorAll('.add-to-cart').forEach(btn => {
      btn.addEventListener('click', () => {
        selectedItem = {
          id: btn.dataset.id,
          name: btn.dataset.name,
          price: parseFloat(btn.dataset.price)
        };

        document.getElementById('modalFoodName').textContent = selectedItem.name;
        document.getElementById('modalPrice').textContent = selectedItem.price.toFixed(2);
        document.getElementById('modalQty').value = 1;
        document.getElementById('modalTotal').textContent = selectedItem.price.toFixed(2);

        document.getElementById('orderModal').style.display = 'block';
      });
    });

    // Update total price when quantity changes
    document.getElementById('modalQty').addEventListener('input', function () {
      let qty = parseInt(this.value);
      document.getElementById('modalTotal').textContent = (qty * selectedItem.price).toFixed(2);
    });

    // Confirm order
    document.getElementById('confirmOrderBtn').addEventListener('click', () => {
      const qty = parseInt(document.getElementById('modalQty').value);

      fetch('/orders', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          menu_id: selectedItem.id,
          quantity: qty,
          price: selectedItem.price
        })
      })
        .then(res => res.json())
        .then(data => {
          if (data.redirect) {
            // If not logged in, redirect to login with return URL
            window.location.href = data.redirect + '?returnUrl=' + encodeURIComponent(window.location.pathname);
          } else if (data.success) {
            alert('âœ… Order placed successfully!');
          } else {
            alert('âŒ Could not place order.');
          }
          document.getElementById('orderModal').style.display = 'none';
        });
    });

    // Cancel modal
    document.getElementById('cancelOrderBtn').addEventListener('click', () => {
      document.getElementById('orderModal').style.display = 'none';
    });
  </script>

  <%- include('../partials/footersubpage') %>